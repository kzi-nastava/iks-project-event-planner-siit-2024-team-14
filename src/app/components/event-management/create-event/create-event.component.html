<div class="popup">
  <h1>New event</h1>

  <form class="form" (ngSubmit)="createEvent()">

    <div class="form-section">
      <div class="circle-one"></div>
      <div class="circle-two"></div>
      <div class="circle-three"></div>
      <div class="circle-four"></div>
      <div class="circle-five"></div>
      <div class="circle-six"></div>
    </div>

    <!-- Name -->
    <div class="form-group">
      <textarea id="name" type="text" placeholder="Name" [(ngModel)]="eventData.name" name="name" required></textarea>
    </div>

    <!-- Description -->
    <div class="form-group">
      <textarea id="description" type="text" placeholder="Description" [(ngModel)]="eventData.description" name="description" required></textarea>
    </div>

    <!-- Event Type -->
    <div class="form-group">
      <mat-form-field appearance="outline" class="custom-dropdown">
        <mat-label>Event Type</mat-label>
        <mat-select [(value)]="selectedCategory" name="selectedCategory" (selectionChange)="onEventTypeChange($event.value)">
          <mat-option *ngFor="let eventType of eventTypes" [value]="eventType.name">
            {{ eventType.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Categories -->
    <div class="form-group">
      <fieldset class="form-group">
        <legend>Choose services and products</legend>

        <!-- Show message if no event type is selected -->
        <div *ngIf="!selectedCategory" class="placeholder-message">
          Choose an event type, then services and products will appear.
        </div>

        <!-- Show categories when "All" is selected -->
        <div *ngIf="selectedCategory === 'All'">
          <div *ngFor="let category of categories">
            <label>
              <input
                type="checkbox"
                name="services"
                [value]="category.name"
                (change)="onCategoryChange($event, category)"
              />
              {{ category.name }}
            </label>
          </div>
        </div>

        <!-- Show categories dynamically when a specific event type is selected -->
        <div *ngIf="selectedCategory && selectedCategory !== 'All'">
          <div *ngFor="let category of categories">
            <label>
              <input
                type="checkbox"
                name="services"
                [value]="category.name"
                (change)="onCategoryChange($event, category)"
              />
              {{ category.name }}
            </label>
          </div>
        </div>
      </fieldset>
    </div>

    <!-- Guest Number -->
    <div class="form-group">
      <input
        id="guest-number"
        type="number"
        min="1"
        placeholder="Maximal number of guests"
        [(ngModel)]="eventData.guestNumber"
        name="guest-number"
        required
      />
    </div>

    <!-- Privacy Type -->
    <div class="button-container">
      <button
        class="custom-radio-btn"
        [class.selected]="eventData.type === '1'"
        (click)="eventData.type = '1'"
        type="button">Open
      </button>

      <button
        class="custom-radio-btn"
        [class.selected]="eventData.type === '2'"
        (click)="eventData.type = '2'"
        type="button">Closed
      </button>
    </div>


    <!-- Dates -->
    <div class="form-group">
      <textarea id="location" type="text" placeholder="Location" [(ngModel)]="eventData.location" name="location" required></textarea>
    </div>

    <!-- Group the Date Pickers together in one row -->
    <div class="form-group date-picker-group">
      <mat-form-field appearance="outline" class="custom-date-picker">
        <ng-container *ngIf="!eventData.startDate">
          <label>Start Date</label>
        </ng-container>
        <input matInput [matDatepicker]="startPicker" [(ngModel)]="eventData.startDate" (change)="onStartDateChange()" [min]="minDate" name="startDate" readonly (ngModelChange)="onStartDateChange()">
        <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker startView="year"></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="custom-date-picker">
        <ng-container *ngIf="!eventData.endDate">
          <label>End Date</label>
        </ng-container>
        <input matInput [matDatepicker]="endPicker" [(ngModel)]="eventData.endDate" name="endDate" readonly (ngModelChange)="onEndDateChange()">
        <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker startView="year"></mat-datepicker>
      </mat-form-field>
    </div>

    <!-- Photo Upload -->
    <div class="form-group">
      <input id="photo" type="file" accept="image/*" (change)="onFileSelected($event)" />
    </div>

    <!-- Error Message Display -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <button type="submit" class="create-button">Create</button>

  </form>
</div>

<!-- Success Modal -->
<app-message-popup
  *ngIf="showModal"
  [isVisible]="showModal"
  [modalTitle]="modalTitle"
  [message]="modalMessage"
  [showOkButton]="showOkButton"
  (close)="closeModal()"
></app-message-popup>
